(()=>{"use strict";var e=function(e,t,n){!function(e){return e.some((function(e){return!e.validity.valid}))}(e)?(t.classList.remove(n),t.disabled=!1):(t.classList.add(n),t.disabled=!0)};function t(e){"Escape"===e.key&&o(document.querySelector(".popup_opened"))}function n(e){e.classList.add("popup_opened"),q.forEach((function(e){e.closest(".popup").classList.contains("profile-popup")?(e.disabled=!1,e.classList.remove("form__savebtn_inactive")):e.closest(".popup").classList.contains("profile-popup")||(e.disabled=!0,e.classList.add("form__savebtn_inactive"))})),document.addEventListener("keydown",t)}function o(e){e.classList.remove("popup_opened"),document.removeEventListener("keydown",t)}var c,r,a,i,l,u,s,d={baseUrl:"https://nomoreparties.co/v1/plus-cohort-12",headers:{authorization:"8f6d1960-4165-4690-8fd7-af73d50cc61b","Content-Type":"application/json"}},f=function(e){return e.ok?e.json():Promise.reject(e.status)},p=function(){return fetch("".concat(d.baseUrl,"/cards"),{headers:d.headers}).then((function(e){return f(e)}))},_=function(e){return fetch("".concat(d.baseUrl,"/cards/likes/").concat(e),{method:"PUT",headers:d.headers}).then((function(e){return f(e)}))},m=function(e){return fetch("".concat(d.baseUrl,"/cards/likes/").concat(e),{method:"DELETE",headers:d.headers}).then((function(e){return f(e)}))},h=document.querySelectorAll(".popup"),v=document.querySelector(".image-popup"),y=document.querySelector(".profile-popup"),S=document.querySelector(".card-popup"),b=document.querySelector(".avatar-popup"),g=(document.querySelector(".delete-popup"),document.querySelector(".profile__editbtn")),q=document.querySelectorAll(".form__savebtn"),k=(document.querySelector(".button__delete"),document.querySelectorAll(".popup__closebtn")),L=document.querySelector(".profile__addbtn"),E=document.querySelector(".profile__avatar-editbtn"),C=(document.querySelectorAll(".places__deletebtn"),document.querySelector(".edit-profile")),x=document.querySelector(".edit-place"),A=document.querySelector(".edit-avatar"),N=document.querySelector(".form__input_link"),U=document.querySelector(".form__input_name"),T=document.querySelector(".form__input_job"),w=document.querySelector(".form__input_place"),P=document.querySelector(".form__input_avatar"),j=document.querySelector(".profile__avatar"),B=document.querySelector(".profile__avatar-overlay"),H=document.querySelector(".popup__container_avatar"),O=document.querySelector(".popup__container_delete"),D=document.querySelector(".profile__title"),J=document.querySelector(".profile__subtitle"),I=document.querySelector(".places"),R=document.querySelector(".places-new").content,z=document.querySelector(".image-popup__photolink"),M=document.querySelector(".image-popup__caption");function F(e,t){console.log(e),t?e="Сохранение...":t||(e=e.closest(".popup").classList.contains("card-popup")?"Создать":"Сохранить")}function G(e,t,o){var c=R.cloneNode(!0);c.querySelector(".places__title").textContent=e,c.querySelector(".places__image").src=t;var r,a=c.querySelector(".places__image"),i=c.querySelector(".places__likes"),l=document.querySelectorAll(".places__likebtn");i.textContent=o,a.alt=e,r=l,p().then((function(e){return e.filter((function(e){return e.likes.filter((function(t){D.textContent==t.name&&r.forEach((function(n){D.textContent==t.name&&e.name==n.closest(".places__title-container").firstElementChild.textContent&&n.classList.add("places__likebtn_active")}))}))}))})).catch((function(e){console.log(e)}));var u=0;c.querySelector(".places__likebtn").addEventListener("click",(function(t){++u%2!=0?p().then((function(n){n.forEach((function(n){e===n.name&&(_(n._id).then((function(e){return i.textContent=e.likes.length})).catch((function(e){console.log(e)})),t.target.classList.add("places__likebtn_active"))}))})).catch((function(e){console.log(e)})):u%2==0&&p().then((function(n){n.forEach((function(n){e===n.name&&(m(n._id).then((function(e){return i.textContent=e.likes.length})).catch((function(e){console.log(e)})),t.target.classList.remove("places__likebtn_active"))}))})).catch((function(e){console.log(e)}))}));var s=c.querySelector(".places__deletebtn");return s.classList.add("places__deletebtn_visible"),s.addEventListener("click",(function(t){t.target.closest(".places__container").remove(),p().then((function(t){t.forEach((function(t){e===t.name&&function(e){return fetch("".concat(d.baseUrl,"/cards/").concat(e),{method:"DELETE",headers:d.headers}).then((function(e){return f(e)}))}(t._id).catch((function(e){console.log(e)}))}))})).catch((function(e){console.log(e)}))})),a.addEventListener("click",(function(){n(v),z.src=this.src,z.alt=e,M.textContent=e})),c}document.querySelector(".places__likebtn"),document.querySelector(".places__likes"),H.style.minHeight="272px",O.style.minHeight="181px",p().then((function(e){e.forEach((function(e){"72af520b988a7099c9eb20ae"!==e.owner._id?I.append(function(e,t,o){var c=R.cloneNode(!0);c.querySelector(".places__title").textContent=e,c.querySelector(".places__image").src=t;var r=c.querySelector(".places__image");r.alt=e;var a=c.querySelector(".places__likes");a.textContent=o;var i,l=document.querySelectorAll(".places__likebtn");i=l,p().then((function(e){return e.filter((function(e){return e.likes.filter((function(t){D.textContent==t.name&&i.forEach((function(t){e.name==t.closest(".places__title-container").firstElementChild.textContent&&t.classList.add("places__likebtn_active")}))}))}))})).catch((function(e){console.log(e)}));var u=0;return c.querySelector(".places__likebtn").addEventListener("click",(function(t){++u%2!=0?p().then((function(n){n.forEach((function(n){e===n.name&&(_(n._id).then((function(e){return a.textContent=e.likes.length})).catch((function(e){console.log(e)})),t.target.classList.add("places__likebtn_active"))}))})).catch((function(e){console.log(e)})):u%2==0&&p().then((function(n){n.forEach((function(n){e===n.name&&(m(n._id).then((function(e){return a.textContent=e.likes.length})).catch((function(e){console.log(e)})),t.target.classList.remove("places__likebtn_active"))}))})).catch((function(e){console.log(e)}))})),r.addEventListener("click",(function(){n(v),z.src=this.src,z.alt=e,M.textContent=e})),c}(e.name,e.link,e.likes.length)):"72af520b988a7099c9eb20ae"===e.owner._id&&I.prepend(G(e.name,e.link,e.likes.length))}))})).catch((function(e){console.log(e)})),fetch("".concat(d.baseUrl,"/users/me"),{headers:d.headers}).then((function(e){return f(e)})).then((function(e){D.textContent=e.name,J.textContent=e.about,j.style.backgroundImage="URL(".concat(e.avatar,")")})).catch((function(e){console.log(e)})),r=(c={formSelector:".form",inputSelector:".form__input",submitButtonSelector:".form__savebtn",inactiveButtonClass:"form__savebtn_inactive",inputErrorClass:"form__input_type_error",errorClass:"form__input-error"}).formSelector,a=c.inputSelector,i=c.submitButtonSelector,l=c.inactiveButtonClass,u=c.inputErrorClass,s=c.errorClass,Array.from(document.querySelectorAll(r)).forEach((function(t){t.addEventListener("submit",(function(e){e.preventDefault()})),function(t,n,o,c,r,a){var i=Array.from(t.querySelectorAll(n)),l=t.querySelector(o);e(i,l,c),i.forEach((function(n){n.addEventListener("input",(function(){!function(e,t,n,o){t.validity.valid?function(e,t,n,o){var c=e.querySelector(".".concat(t.id,"-error"));t.classList.remove(n),c.classList.remove(o),c.textContent=""}(e,t,n,o):function(e,t,n,o,c){var r=e.querySelector(".".concat(t.id,"-error"));t.classList.add(o),r.classList.add(c),r.textContent=n}(e,t,t.validationMessage,n,o)}(t,n,r,a),e(i,l,c)}))}))}(t,a,i,l,u,s)})),x.addEventListener("submit",(function(e){var t,n;F(e.target.childNodes[5],!0),console.log(e.target.childNodes[5].textContent),(t=w.value,n=N.value,fetch("".concat(d.baseUrl,"/cards"),{method:"POST",headers:d.headers,body:JSON.stringify({name:t,link:n})}).then((function(e){return f(e)}))).then((function(e){return I.prepend(G(e.name,e.link,e.likes.length))})).catch((function(e){console.log(e)})).finally((function(){F(e.target.childNodes[5],!1)})),o(S),e.target.reset()})),C.addEventListener("submit",(function(e){F(e.target.childNodes[5],!0),function(e,t){return fetch("".concat(d.baseUrl,"/users/me"),{method:"PATCH",headers:d.headers,body:JSON.stringify({name:e,about:t})}).then((function(e){return f(e)}))}(U.value,T.value).catch((function(e){console.log(e)})).finally((function(){F(e.target.childNodes[5],!1)})),D.textContent=U.value,J.textContent=T.value,o(y)})),A.addEventListener("submit",(function(e){var t;F(e.target.childNodes[3],!0),(t=P.value,fetch("".concat(d.baseUrl,"/users/me/avatar"),{method:"PATCH",headers:d.headers,body:JSON.stringify({avatar:t})}).then((function(e){return f(e)}))).then((function(e){return j.style.backgroundImage="URL(".concat(e.avatar,")")})).catch((function(e){console.log(e)})).finally((function(){F(e.target.childNodes[3],!1)})),o(b),e.target.reset()})),k.forEach((function(e){e.addEventListener("click",(function(e){o(e.target.closest(".popup"))}))})),h.forEach((function(e){e.addEventListener("click",(function(e){e.target.classList.contains("popup")&&o(e.target.closest(".popup"))}))})),g.addEventListener("click",(function(){U.value=D.textContent,T.value=J.textContent,n(y)})),E.addEventListener("click",(function(){return n(b)})),B.addEventListener("mouseover",(function(){E.style.visibility="visible",E.style.opacity="1",E.style.transition="all 1s ease"})),B.addEventListener("mouseout",(function(){E.style.visibility="hidden",E.style.opacity="0",E.style.transition="all 1s ease"})),L.addEventListener("click",(function(){return n(S)}))})();