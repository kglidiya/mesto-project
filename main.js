(()=>{"use strict";var e=function(e,t,n){!function(e){return e.some((function(e){return!e.validity.valid}))}(e)?t.classList.remove(n):t.classList.add(n)};function t(e){e.classList.add("popup_opened")}function n(e){e.classList.remove("popup_opened")}function o(e,n,o){var c=J.cloneNode(!0);c.querySelector(".places__title").textContent=e,c.querySelector(".places__image").src=n;var r,a=c.querySelector(".places__image"),i=c.querySelector(".places__likes"),l=document.querySelectorAll(".places__likebtn");i.textContent=o,a.alt=e,r=l,f.then((function(e){return e.filter((function(e){return e.likes.filter((function(t){O.textContent==t.name&&r.forEach((function(n){O.textContent==t.name&&e.name==n.closest(".places__title-container").firstElementChild.textContent&&n.classList.add("places__likebtn_active")}))}))}))})).catch((function(e){console.log(e)}));var s=0;c.querySelector(".places__likebtn").addEventListener("click",(function(t){++s%2!=0?f.then((function(n){n.forEach((function(n){e===n.name&&(_(n._id,i),t.target.classList.add("places__likebtn_active"))}))})).catch((function(e){console.log(e)})):s%2==0&&f.then((function(n){n.forEach((function(n){e===n.name&&(m(n._id,i),t.target.classList.remove("places__likebtn_active"))}))})).catch((function(e){console.log(e)}))}));var u=c.querySelector(".places__deletebtn");return u.classList.add("places__deletebtn_visible"),u.addEventListener("click",(function(t){return t.target.closest(".places__container").remove(),f.then((function(t){t.forEach((function(t){e===t.name&&p(t._id)}))})).catch((function(e){console.log(e)}))})),a.addEventListener("click",(function(){t(v),I.src=this.src,I.alt=e,R.textContent=e})),c}var c,r,a,i,l,s,u,d={baseUrl:"https://nomoreparties.co/v1/plus-cohort-12",headers:{authorization:"8f6d1960-4165-4690-8fd7-af73d50cc61b","Content-Type":"application/json"}},f=fetch("".concat(d.baseUrl,"/cards"),{headers:{authorization:"8f6d1960-4165-4690-8fd7-af73d50cc61b","Content-Type":"application/json"}}).then((function(e){return e.ok?e.json():Promise.reject(e.status)})),p=function(e){return fetch("".concat(d.baseUrl,"/cards/").concat(e),{method:"DELETE",headers:d.headers}).then((function(e){return e.ok?e.json():Promise.reject(e.status)})).catch((function(e){console.log(e)}))},_=function(e,t){return fetch("".concat(d.baseUrl,"/cards/likes/").concat(e),{method:"PUT",headers:{authorization:"8f6d1960-4165-4690-8fd7-af73d50cc61b","Content-Type":"application/json"}}).then((function(e){return e.ok?e.json():Promise.reject(e.status)})).then((function(e){return t.textContent=e.likes.length})).catch((function(e){console.log(e)}))},m=function(e,t){return fetch("".concat(d.baseUrl,"/cards/likes/").concat(e),{method:"DELETE",headers:{authorization:"8f6d1960-4165-4690-8fd7-af73d50cc61b","Content-Type":"application/json"}}).then((function(e){return e.ok?e.json():Promise.reject(e.status)})).then((function(e){return t.textContent=e.likes.length})).catch((function(e){console.log(e)}))},h=document.querySelectorAll(".popup"),v=document.querySelector(".image-popup"),y=document.querySelector(".profile-popup"),b=document.querySelector(".card-popup"),S=document.querySelector(".avatar-popup"),k=document.querySelector(".profile__editbtn"),g=document.querySelectorAll(".form__savebtn"),q=document.querySelectorAll(".popup__closebtn"),E=document.querySelector(".profile__addbtn"),L=document.querySelector(".profile__avatar-editbtn"),C=(document.querySelectorAll(".places__deletebtn"),document.querySelector(".edit-profile")),x=document.querySelector(".edit-place"),j=document.querySelector(".edit-avatar"),A=document.querySelector(".form__input_link"),P=document.querySelector(".form__input_name"),U=document.querySelector(".form__input_job"),T=document.querySelector(".form__input_place"),w=document.querySelector(".form__input_avatar"),z=document.querySelector(".profile__avatar"),N=document.querySelector(".profile__avatar-overlay"),B=document.querySelector(".popup__container_avatar"),O=document.querySelector(".profile__title"),D=document.querySelector(".profile__subtitle"),H=document.querySelector(".places"),J=document.querySelector(".places-new").content,I=document.querySelector(".image-popup__photolink"),R=document.querySelector(".image-popup__caption");function M(e){e?g[0].textContent="Сохранение...":e||(g[0].textContent="Сохранить")}document.querySelector(".places__likebtn"),B.style.minHeight="272px",f.then((function(e){e.forEach((function(e){"72af520b988a7099c9eb20ae"!==e.owner._id?H.prepend(function(e,n,o){var c=J.cloneNode(!0);c.querySelector(".places__title").textContent=e,c.querySelector(".places__image").src=n;var r=c.querySelector(".places__image");r.alt=e;var a=c.querySelector(".places__likes");a.textContent=o;var i,l=document.querySelectorAll(".places__likebtn");i=l,f.then((function(e){return e.filter((function(e){return e.likes.filter((function(t){O.textContent==t.name&&i.forEach((function(t){e.name==t.closest(".places__title-container").firstElementChild.textContent&&t.classList.add("places__likebtn_active")}))}))}))})).catch((function(e){console.log(e)}));var s=0;return c.querySelector(".places__likebtn").addEventListener("click",(function(t){++s%2!=0?(console.log("like"),f.then((function(n){n.forEach((function(n){e===n.name&&(_(n._id,a),t.target.classList.add("places__likebtn_active"))}))})).catch((function(e){console.log(e)}))):s%2==0&&(console.log("dislike"),f.then((function(n){n.forEach((function(n){e===n.name&&(m(n._id,a),t.target.classList.remove("places__likebtn_active"))}))})).catch((function(e){console.log(e)})))})),r.addEventListener("click",(function(){t(v),I.src=this.src,I.alt=e,R.textContent=e})),c}(e.name,e.link,e.likes.length)):"72af520b988a7099c9eb20ae"===e.owner._id&&H.prepend(o(e.name,e.link,e.likes.length))}))})).catch((function(e){console.log(e)})),fetch("".concat(d.baseUrl,"/users/me"),{headers:d.headers}).then((function(e){return e.ok?e.json():Promise.reject(e.status)})).then((function(e){O.textContent=e.name,D.textContent=e.about,z.style.backgroundImage="URL(".concat(e.avatar,")")})).catch((function(e){console.log(e)})),E.addEventListener("click",(function(){return t(b)})),L.addEventListener("click",(function(){return t(S)})),N.addEventListener("mouseover",(function(){L.style.visibility="visible",L.style.opacity="1",L.style.transition="all 1s ease"})),N.addEventListener("mouseout",(function(){L.style.visibility="hidden",L.style.opacity="0",L.style.transition="all 1s ease"})),k.addEventListener("click",(function(){P.value=O.textContent,U.value=D.textContent,t(y)})),document.addEventListener("keydown",(function(e){"Escape"===e.key&&h.forEach((function(e){e.classList.contains("popup_opened")?n(e):e.classList.contains("popup_opened")||document.removeEventListener("keydown",n(e))}))})),q.forEach((function(e){e.addEventListener("click",(function(e){n(e.target.closest(".popup"))}))})),h.forEach((function(e){e.addEventListener("click",(function(e){e.target.classList.contains("popup")&&n(e.target.closest(".popup"))}))})),x.addEventListener("submit",(function(){var e,t;e=T.value,t=A.value,fetch("".concat(d.baseUrl,"/cards"),{method:"POST",headers:{authorization:"8f6d1960-4165-4690-8fd7-af73d50cc61b","Content-Type":"application/json"},body:JSON.stringify({name:e,link:t})}).then((function(e){return e.ok?e.json():Promise.reject(e.status)})).then((function(e){if("72af520b988a7099c9eb20ae"!==e.owner._id)return!1;H.prepend(o(e.name,e.link,e.likes.length))})).catch((function(e){console.log(e)})),n(b),T.value="",A.value=""})),C.addEventListener("submit",(function(){M(!0),function(){var e=P.value,t=U.value;fetch("".concat(d.baseUrl,"/users/me"),{method:"PATCH",headers:d.headers,body:JSON.stringify({name:e,about:t})}).then((function(e){return e.ok?e.json():Promise.reject(e.status)})).catch((function(e){console.log(e)})).finally((function(){M(!1)}))}(),O.textContent=P.value,D.textContent=U.value,n(y)})),j.addEventListener("submit",(function(){var e;e=w.value,fetch("".concat(d.baseUrl,"/users/me/avatar"),{method:"PATCH",headers:d.headers,body:JSON.stringify({avatar:e})}).then((function(e){return e.ok?e.json():Promise.reject(e.status)})).catch((function(e){console.log(e)})),z.style.backgroundImage="URL(".concat(w.value,")"),n(S),w.value=""})),r=(c={formSelector:".form",inputSelector:".form__input",submitButtonSelector:".form__savebtn",inactiveButtonClass:"form__savebtn_inactive",inputErrorClass:"form__input_type_error",errorClass:"form__input-error"}).formSelector,a=c.inputSelector,i=c.submitButtonSelector,l=c.inactiveButtonClass,s=c.inputErrorClass,u=c.errorClass,Array.from(document.querySelectorAll(r)).forEach((function(t){t.addEventListener("submit",(function(e){e.preventDefault()})),function(t,n,o,c,r,a){var i=Array.from(t.querySelectorAll(n)),l=t.querySelector(o);e(i,l,c),i.forEach((function(n){n.addEventListener("input",(function(){(function(e,t,n,o){t.validity.valid?function(e,t,n,o){var c=e.querySelector(".".concat(t.id,"-error"));t.classList.remove(n),c.classList.remove(o),c.textContent=""}(e,t,n,o):function(e,t,n,o,c){var r=e.querySelector(".".concat(t.id,"-error"));t.classList.add(o),r.classList.add(c),r.textContent=n,console.log(o),console.log(r),console.log(t)}(e,t,t.validationMessage,n,o)})(t,n,r,a),e(i,l,c)}))}))}(t,a,i,l,s,u)}))})();