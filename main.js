(()=>{"use strict";var e=function(e,t,n){!function(e){return e.some((function(e){return!e.validity.valid}))}(e)?(t.classList.remove(n),t.disabled=!1):(t.classList.add(n),t.disabled=!0)};function t(e){"Escape"===e.key&&(document.querySelector(".popup_opened"),o())}function n(e){e.classList.add("popup_opened");var n,o=e.querySelector(".form__savebtn");(e.classList.contains("card-popup")||e.classList.contains("avatar-popup"))&&((n=o).disabled=!0,n.classList.add("form__savebtn_inactive")),document.addEventListener("keydown",t)}function o(){document.querySelector(".popup_opened").classList.remove("popup_opened"),document.removeEventListener("keydown",t)}var r,c,a,i,l,s,u,d={baseUrl:"https://nomoreparties.co/v1/plus-cohort-12",headers:{authorization:"8f6d1960-4165-4690-8fd7-af73d50cc61b","Content-Type":"application/json"}},p=function(e){return e.ok?e.json():Promise.reject(e.status)},f=document.querySelectorAll(".popup"),_=document.querySelector(".image-popup"),m=document.querySelector(".profile-popup"),v=document.querySelector(".card-popup"),y=document.querySelector(".avatar-popup"),h=(document.querySelector(".delete-popup"),document.querySelector(".profile__editbtn")),S=document.querySelectorAll(".form__savebtn"),b=(document.querySelector(".button__delete"),document.querySelectorAll(".popup__closebtn")),q=document.querySelector(".profile__addbtn"),L=document.querySelector(".profile__avatar-editbtn"),k=(document.querySelectorAll(".places__deletebtn"),document.querySelector(".edit-profile")),g=document.querySelector(".edit-place"),E=document.querySelector(".edit-avatar"),C=document.querySelector(".form__input_link"),x=document.querySelector(".form__input_name"),U=document.querySelector(".form__input_job"),A=document.querySelector(".form__input_place"),T=document.querySelector(".form__input_avatar"),w=document.querySelector(".profile__avatar"),P=document.querySelector(".profile__avatar-overlay"),j=document.querySelector(".popup__container_avatar"),B=document.querySelector(".popup__container_delete"),H=document.querySelector(".profile__title"),N=document.querySelector(".profile__subtitle"),O=document.querySelector(".places"),D=document.querySelector(".places-new").content,J=document.querySelector(".image-popup__photolink"),I=document.querySelector(".image-popup__caption");function R(e){S.forEach((function(t){e||(t.closest(".popup").classList.contains("card-popup")?t.textContent="Создать":t.textContent="Сохранить"),e&&(t.textContent="Сохранение...")}))}function z(e,t,o,r,c,a,i){var l=D.cloneNode(!0);l.querySelector(".places__title").textContent=e,l.querySelector(".places__image").src=t;var s=l.querySelector(".places__image");s.alt=e;var u=l.querySelector(".places__likes");u.textContent=o;var f=l.querySelector(".places__likebtn"),m=l.querySelector(".places__deletebtn"),v=m.closest(".places__container");return a===i?f.classList.add("places__likebtn_active"):f.classList.remove("places__likebtn_active"),"72af520b988a7099c9eb20ae"===r&&m.classList.add("places__deletebtn_visible"),m.addEventListener("click",(function(){var e;(e=c,fetch("".concat(d.baseUrl,"/cards/").concat(e),{method:"DELETE",headers:d.headers}).then((function(e){return p(e)}))).catch((function(e){console.log(e)})),v.remove()})),f.addEventListener("click",(function(e){var t;e.target.classList.contains("places__likebtn_active")?((t=c,fetch("".concat(d.baseUrl,"/cards/likes/").concat(t),{method:"DELETE",headers:d.headers}).then((function(e){return p(e)}))).then((function(e){return u.textContent=e.likes.length})).catch((function(e){console.log(e)})),e.target.classList.remove("places__likebtn_active")):e.target.classList.contains("places__likebtn_active")||(function(e){return fetch("".concat(d.baseUrl,"/cards/likes/").concat(e),{method:"PUT",headers:d.headers}).then((function(e){return p(e)}))}(c).then((function(e){return u.textContent=e.likes.length})).catch((function(e){console.log(e)})),e.target.classList.add("places__likebtn_active"))})),s.addEventListener("click",(function(){n(_),J.src=this.src,J.alt=e,I.textContent=e})),l}document.querySelector(".places__likebtn"),document.querySelector(".places__likes"),j.style.minHeight="272px",B.style.minHeight="181px",Promise.all([fetch("".concat(d.baseUrl,"/cards"),{headers:d.headers}).then((function(e){return p(e)})),fetch("".concat(d.baseUrl,"/users/me"),{headers:d.headers}).then((function(e){return p(e)}))]).then((function(e){e[0].forEach((function(t){var n;t.likes.forEach((function(e){n=e.name})),O.append(z(t.name,t.link,t.likes.length,t.owner._id,t._id,n,e[1].name))})),H.textContent=e[1].name,N.textContent=e[1].about,w.style.backgroundImage="URL(".concat(e[1].avatar,")")})),c=(r={formSelector:".form",inputSelector:".form__input",submitButtonSelector:".form__savebtn",inactiveButtonClass:"form__savebtn_inactive",inputErrorClass:"form__input_type_error",errorClass:"form__input-error"}).formSelector,a=r.inputSelector,i=r.submitButtonSelector,l=r.inactiveButtonClass,s=r.inputErrorClass,u=r.errorClass,Array.from(document.querySelectorAll(c)).forEach((function(t){t.addEventListener("submit",(function(e){e.preventDefault()})),function(t,n,o,r,c,a){var i=Array.from(t.querySelectorAll(n)),l=t.querySelector(o);e(i,l,r),i.forEach((function(n){n.addEventListener("input",(function(){!function(e,t,n,o){t.validity.valid?function(e,t,n,o){var r=e.querySelector(".".concat(t.id,"-error"));t.classList.remove(n),r.classList.remove(o),r.textContent=""}(e,t,n,o):function(e,t,n,o,r){var c=e.querySelector(".".concat(t.id,"-error"));t.classList.add(o),c.classList.add(r),c.textContent=n}(e,t,t.validationMessage,n,o)}(t,n,c,a),e(i,l,r)}))}))}(t,a,i,l,s,u)})),g.addEventListener("submit",(function(e){var t,n;R(!0),(t=A.value,n=C.value,fetch("".concat(d.baseUrl,"/cards"),{method:"POST",headers:d.headers,body:JSON.stringify({name:t,link:n})}).then((function(e){return p(e)}))).then((function(t){O.prepend(z(t.name,t.link,t.likes.length,t.owner._id,t._id,t.likes.name,t.owner.name)),o(),e.target.reset()})).catch((function(e){console.log(e)})).finally((function(){R(!1)}))})),k.addEventListener("submit",(function(){R(!0),function(e,t){return fetch("".concat(d.baseUrl,"/users/me"),{method:"PATCH",headers:d.headers,body:JSON.stringify({name:e,about:t})}).then((function(e){return p(e)}))}(x.value,U.value).then((function(e){H.textContent=e.name,N.textContent=e.about,o()})).catch((function(e){console.log(e)})).finally((function(){R(!1)}))})),E.addEventListener("submit",(function(e){var t;R(!0),(t=T.value,fetch("".concat(d.baseUrl,"/users/me/avatar"),{method:"PATCH",headers:d.headers,body:JSON.stringify({avatar:t})}).then((function(e){return p(e)}))).then((function(t){w.style.backgroundImage="URL(".concat(t.avatar,")"),o(),e.target.reset()})).catch((function(e){console.log(e)})).finally((function(){R(!1)}))})),b.forEach((function(e){e.addEventListener("click",(function(e){o(e.target.closest(".popup"))}))})),f.forEach((function(e){e.addEventListener("click",(function(e){e.target.classList.contains("popup")&&o(e.target.closest(".popup"))}))})),h.addEventListener("click",(function(){x.value=H.textContent,U.value=N.textContent,n(m)})),L.addEventListener("click",(function(){return n(y)})),P.addEventListener("mouseover",(function(){L.style.visibility="visible",L.style.opacity="1",L.style.transition="all 1s ease"})),P.addEventListener("mouseout",(function(){L.style.visibility="hidden",L.style.opacity="0",L.style.transition="all 1s ease"})),q.addEventListener("click",(function(){return n(v)}))})();