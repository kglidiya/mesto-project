(()=>{"use strict";var e=function(e,t,n){!function(e){return e.some((function(e){return!e.validity.valid}))}(e)?(t.classList.remove(n),t.disabled=!1):(t.classList.add(n),t.disabled=!0)};function t(e){"Escape"===e.key&&(document.querySelector(".popup_opened"),o())}function n(e){e.classList.add("popup_opened"),document.addEventListener("keydown",t)}function o(){document.querySelector(".popup_opened").classList.remove("popup_opened"),document.removeEventListener("keydown",t)}var r,c,a,i,l,s,u,d={baseUrl:"https://nomoreparties.co/v1/plus-cohort-12",headers:{authorization:"8f6d1960-4165-4690-8fd7-af73d50cc61b","Content-Type":"application/json"}},p=function(e){return e.ok?e.json():Promise.reject(e.status)},_=document.querySelectorAll(".popup"),f=document.querySelector(".image-popup"),m=document.querySelector(".profile-popup"),v=document.querySelector(".card-popup"),y=document.querySelector(".avatar-popup"),h=(document.querySelector(".delete-popup"),document.querySelector(".profile__editbtn")),b=(document.querySelector(".button__delete"),document.querySelectorAll(".popup__closebtn")),S=document.querySelector(".profile__addbtn"),q=document.querySelector(".profile__avatar-editbtn"),L=document.querySelector(".edit-profile"),g=document.querySelector(".edit-place"),k=document.querySelector(".edit-avatar"),E=document.querySelector(".form__input_link"),C=document.querySelector(".form__input_name"),x=document.querySelector(".form__input_job"),U=document.querySelector(".form__input_place"),A=document.querySelector(".form__input_avatar"),N=document.querySelector(".profile__avatar"),T=document.querySelector(".profile__avatar-overlay"),w=document.querySelector(".popup__container_avatar"),P=document.querySelector(".popup__container_delete"),j=document.querySelector(".profile__title"),B=document.querySelector(".profile__subtitle"),H=document.querySelector(".places"),O=document.querySelector(".places-new").content,D=document.querySelector(".image-popup__photolink"),J=document.querySelector(".image-popup__caption");function I(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"Сохранить";e||(t.textContent=n),e&&(t.textContent="Сохранение...")}function R(e,t,o,r,c,a,i){var l=O.cloneNode(!0);l.querySelector(".places__title").textContent=e,l.querySelector(".places__image").src=t;var s=l.querySelector(".places__image");s.alt=e;var u=l.querySelector(".places__likes");u.textContent=o;var _=l.querySelector(".places__likebtn"),m=l.querySelector(".places__deletebtn"),v=m.closest(".places__container");return a===i?_.classList.add("places__likebtn_active"):_.classList.remove("places__likebtn_active"),"72af520b988a7099c9eb20ae"===r&&m.classList.add("places__deletebtn_visible"),m.addEventListener("click",(function(){var e;(e=c,fetch("".concat(d.baseUrl,"/cards/").concat(e),{method:"DELETE",headers:d.headers}).then((function(e){return p(e)}))).catch((function(e){console.log(e)})),v.remove()})),_.addEventListener("click",(function(e){var t;e.target.classList.contains("places__likebtn_active")?((t=c,fetch("".concat(d.baseUrl,"/cards/likes/").concat(t),{method:"DELETE",headers:d.headers}).then((function(e){return p(e)}))).then((function(e){return u.textContent=e.likes.length})).catch((function(e){console.log(e)})),e.target.classList.remove("places__likebtn_active")):e.target.classList.contains("places__likebtn_active")||(function(e){return fetch("".concat(d.baseUrl,"/cards/likes/").concat(e),{method:"PUT",headers:d.headers}).then((function(e){return p(e)}))}(c).then((function(e){return u.textContent=e.likes.length})).catch((function(e){console.log(e)})),e.target.classList.add("places__likebtn_active"))})),s.addEventListener("click",(function(){n(f),D.src=this.src,D.alt=e,J.textContent=e})),l}document.querySelector(".places__likebtn"),document.querySelector(".places__likes"),w.style.minHeight="272px",P.style.minHeight="181px",Promise.all([fetch("".concat(d.baseUrl,"/cards"),{headers:d.headers}).then((function(e){return p(e)})),fetch("".concat(d.baseUrl,"/users/me"),{headers:d.headers}).then((function(e){return p(e)}))]).then((function(e){e[0].forEach((function(t){var n;t.likes.forEach((function(e){n=e.name})),H.append(R(t.name,t.link,t.likes.length,t.owner._id,t._id,n,e[1].name))})),j.textContent=e[1].name,B.textContent=e[1].about,N.style.backgroundImage="URL(".concat(e[1].avatar,")")})),c=(r={formSelector:".form",inputSelector:".form__input",submitButtonSelector:".form__savebtn",inactiveButtonClass:"form__savebtn_inactive",inputErrorClass:"form__input_type_error",errorClass:"form__input-error"}).formSelector,a=r.inputSelector,i=r.submitButtonSelector,l=r.inactiveButtonClass,s=r.inputErrorClass,u=r.errorClass,Array.from(document.querySelectorAll(c)).forEach((function(t){t.addEventListener("submit",(function(e){e.preventDefault()})),function(t,n,o,r,c,a){var i=Array.from(t.querySelectorAll(n)),l=t.querySelector(o);e(i,l,r),i.forEach((function(n){n.addEventListener("input",(function(){!function(e,t,n,o){t.validity.valid?function(e,t,n,o){var r=e.querySelector(".".concat(t.id,"-error"));t.classList.remove(n),r.classList.remove(o),r.textContent=""}(e,t,n,o):function(e,t,n,o,r){var c=e.querySelector(".".concat(t.id,"-error"));t.classList.add(o),c.classList.add(r),c.textContent=n}(e,t,t.validationMessage,n,o)}(t,n,c,a),e(i,l,r)}))}))}(t,a,i,l,s,u)})),g.addEventListener("submit",(function(e){var t,n;(t=U.value,n=E.value,fetch("".concat(d.baseUrl,"/cards"),{method:"POST",headers:d.headers,body:JSON.stringify({name:t,link:n})}).then((function(e){return p(e)}))).then((function(t){H.prepend(R(t.name,t.link,t.likes.length,t.owner._id,t._id,t.likes.name,t.owner.name)),o(),e.target.reset()})).catch((function(e){console.log(e)})).finally((function(){}))})),L.addEventListener("submit",(function(){(function(e,t){return fetch("".concat(d.baseUrl,"/users/me"),{method:"PATCH",headers:d.headers,body:JSON.stringify({name:e,about:t})}).then((function(e){return p(e)}))})(C.value,x.value).then((function(e){j.textContent=e.name,B.textContent=e.about,o()})).catch((function(e){console.log(e)})).finally((function(){}))})),k.addEventListener("submit",(function(e){var t;I(!0,e.target.childNodes[3]),console.log(e.target.childNodes[3]),(t=A.value,fetch("".concat(d.baseUrl,"/users/me/avatar"),{method:"PATCH",headers:d.headers,body:JSON.stringify({avatar:t})}).then((function(e){return p(e)}))).then((function(t){N.style.backgroundImage="URL(".concat(t.avatar,")"),o(),e.target.reset()})).catch((function(e){console.log(e)})).finally((function(){I(!1,e.target.childNodes[3])}))})),b.forEach((function(e){e.addEventListener("click",(function(e){o(e.target.closest(".popup"))}))})),_.forEach((function(e){e.addEventListener("click",(function(e){e.target.classList.contains("popup")&&o(e.target.closest(".popup"))}))})),h.addEventListener("click",(function(){C.value=j.textContent,x.value=B.textContent;var e=m.querySelector(".form__savebtn");e.disabled=!0,e.classList.add("form__savebtn_inactive"),n(m)})),q.addEventListener("click",(function(){var e=y.querySelector(".form__savebtn");e.disabled=!0,e.classList.add("form__savebtn_inactive"),n(y)})),T.addEventListener("mouseover",(function(){q.style.visibility="visible",q.style.opacity="1",q.style.transition="all 1s ease"})),T.addEventListener("mouseout",(function(){q.style.visibility="hidden",q.style.opacity="0",q.style.transition="all 1s ease"})),S.addEventListener("click",(function(){var e=v.querySelector(".form__savebtn");e.disabled=!0,e.classList.add("form__savebtn_inactive"),n(v)}))})();