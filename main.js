(()=>{"use strict";var e=function(e,t,n){!function(e){return e.some((function(e){return!e.validity.valid}))}(e)?(t.classList.remove(n),t.disabled=!1):(t.classList.add(n),t.disabled=!0)};function t(e){"Escape"===e.key&&o(document.querySelector(".popup_opened"))}function n(e){e.classList.add("popup_opened"),document.addEventListener("keydown",t)}function o(e){e.classList.remove("popup_opened"),document.removeEventListener("keydown",t)}function c(e,t,o){var c=R.cloneNode(!0);c.querySelector(".places__title").textContent=e,c.querySelector(".places__image").src=t;var r,a=c.querySelector(".places__image"),i=c.querySelector(".places__likes"),l=document.querySelectorAll(".places__likebtn");i.textContent=o,a.alt=e,r=l,p.then((function(e){return e.filter((function(e){return e.likes.filter((function(t){D.textContent==t.name&&r.forEach((function(n){D.textContent==t.name&&e.name==n.closest(".places__title-container").firstElementChild.textContent&&n.classList.add("places__likebtn_active")}))}))}))})).catch((function(e){console.log(e)}));var u=0;c.querySelector(".places__likebtn").addEventListener("click",(function(t){++u%2!=0?p.then((function(n){n.forEach((function(n){e===n.name&&(m(n._id,i),t.target.classList.add("places__likebtn_active"))}))})).catch((function(e){console.log(e)})):u%2==0&&p.then((function(n){n.forEach((function(n){e===n.name&&(h(n._id,i),t.target.classList.remove("places__likebtn_active"))}))})).catch((function(e){console.log(e)}))}));var s=c.querySelector(".places__deletebtn");return s.classList.add("places__deletebtn_visible"),s.addEventListener("click",(function(t){var n=t.target.closest(".places__container");return p.then((function(t){t.forEach((function(t){e===t.name&&(_(t._id),n.remove())}))})).catch((function(e){console.log(e)}))})),a.addEventListener("click",(function(){n(y),M.src=this.src,M.alt=e,F.textContent=e})),c}var r,a,i,l,u,s,d,f={baseUrl:"https://nomoreparties.co/v1/plus-cohort-12",headers:{authorization:"8f6d1960-4165-4690-8fd7-af73d50cc61b","Content-Type":"application/json"}},p=fetch("".concat(f.baseUrl,"/cards"),{headers:{authorization:"8f6d1960-4165-4690-8fd7-af73d50cc61b","Content-Type":"application/json"}}).then((function(e){return e.ok?e.json():Promise.reject(e.status)})),_=function(e){return fetch("".concat(f.baseUrl,"/cards/").concat(e),{method:"DELETE",headers:f.headers}).then((function(e){return e.ok?e.json():Promise.reject(e.status)})).catch((function(e){console.log(e)}))},m=function(e,t){return fetch("".concat(f.baseUrl,"/cards/likes/").concat(e),{method:"PUT",headers:{authorization:"8f6d1960-4165-4690-8fd7-af73d50cc61b","Content-Type":"application/json"}}).then((function(e){return e.ok?e.json():Promise.reject(e.status)})).then((function(e){return t.textContent=e.likes.length})).catch((function(e){console.log(e)}))},h=function(e,t){return fetch("".concat(f.baseUrl,"/cards/likes/").concat(e),{method:"DELETE",headers:{authorization:"8f6d1960-4165-4690-8fd7-af73d50cc61b","Content-Type":"application/json"}}).then((function(e){return e.ok?e.json():Promise.reject(e.status)})).then((function(e){return t.textContent=e.likes.length})).catch((function(e){console.log(e)}))},v=document.querySelectorAll(".popup"),y=document.querySelector(".image-popup"),b=document.querySelector(".profile-popup"),S=document.querySelector(".card-popup"),k=document.querySelector(".avatar-popup"),q=(document.querySelector(".delete-popup"),document.querySelector(".profile__editbtn")),g=document.querySelectorAll(".form__savebtn"),E=(document.querySelector(".button__delete"),document.querySelectorAll(".popup__closebtn")),L=document.querySelector(".profile__addbtn"),C=document.querySelector(".profile__avatar-editbtn"),x=(document.querySelectorAll(".places__deletebtn"),document.querySelector(".edit-profile")),j=document.querySelector(".edit-place"),A=document.querySelector(".edit-avatar"),P=document.querySelector(".form__input_link"),U=document.querySelector(".form__input_name"),T=document.querySelector(".form__input_job"),w=document.querySelector(".form__input_place"),z=document.querySelector(".form__input_avatar"),N=document.querySelector(".profile__avatar"),B=document.querySelector(".profile__avatar-overlay"),H=document.querySelector(".popup__container_avatar"),O=document.querySelector(".popup__container_delete"),D=document.querySelector(".profile__title"),J=document.querySelector(".profile__subtitle"),I=document.querySelector(".places"),R=document.querySelector(".places-new").content,M=document.querySelector(".image-popup__photolink"),F=document.querySelector(".image-popup__caption");function G(e){e?g[0].textContent="Сохранение...":e||(g[0].textContent="Сохранить")}function K(e){e.forEach((function(e){if(e.classList.contains("button__delete"))return!1;e.disabled=!0,e.classList.add("form__savebtn_inactive")}))}document.querySelector(".places__likebtn"),document.querySelector(".places__likes"),H.style.minHeight="272px",O.style.minHeight="181px",p.then((function(e){e.forEach((function(e){"72af520b988a7099c9eb20ae"!==e.owner._id?I.append(function(e,t,o){var c=R.cloneNode(!0);c.querySelector(".places__title").textContent=e,c.querySelector(".places__image").src=t;var r=c.querySelector(".places__image");r.alt=e;var a=c.querySelector(".places__likes");a.textContent=o;var i,l=document.querySelectorAll(".places__likebtn");i=l,p.then((function(e){return e.filter((function(e){return e.likes.filter((function(t){D.textContent==t.name&&i.forEach((function(t){e.name==t.closest(".places__title-container").firstElementChild.textContent&&t.classList.add("places__likebtn_active")}))}))}))})).catch((function(e){console.log(e)}));var u=0;return c.querySelector(".places__likebtn").addEventListener("click",(function(t){++u%2!=0?p.then((function(n){n.forEach((function(n){e===n.name&&(m(n._id,a),t.target.classList.add("places__likebtn_active"))}))})).catch((function(e){console.log(e)})):u%2==0&&p.then((function(n){n.forEach((function(n){e===n.name&&(h(n._id,a),t.target.classList.remove("places__likebtn_active"))}))})).catch((function(e){console.log(e)}))})),r.addEventListener("click",(function(){n(y),M.src=this.src,M.alt=e,F.textContent=e})),c}(e.name,e.link,e.likes.length)):"72af520b988a7099c9eb20ae"===e.owner._id&&I.prepend(c(e.name,e.link,e.likes.length))}))})).catch((function(e){console.log(e)})),fetch("".concat(f.baseUrl,"/users/me"),{headers:f.headers}).then((function(e){return e.ok?e.json():Promise.reject(e.status)})).then((function(e){D.textContent=e.name,J.textContent=e.about,N.style.backgroundImage="URL(".concat(e.avatar,")")})).catch((function(e){console.log(e)})),a=(r={formSelector:".form",inputSelector:".form__input",submitButtonSelector:".form__savebtn",inactiveButtonClass:"form__savebtn_inactive",inputErrorClass:"form__input_type_error",errorClass:"form__input-error"}).formSelector,i=r.inputSelector,l=r.submitButtonSelector,u=r.inactiveButtonClass,s=r.inputErrorClass,d=r.errorClass,Array.from(document.querySelectorAll(a)).forEach((function(t){t.addEventListener("submit",(function(e){e.preventDefault()})),function(t,n,o,c,r,a){var i=Array.from(t.querySelectorAll(n)),l=t.querySelector(o);e(i,l,c),i.forEach((function(n){n.addEventListener("input",(function(){!function(e,t,n,o){t.validity.valid?function(e,t,n,o){var c=e.querySelector(".".concat(t.id,"-error"));t.classList.remove(n),c.classList.remove(o),c.textContent=""}(e,t,n,o):function(e,t,n,o,c){var r=e.querySelector(".".concat(t.id,"-error"));t.classList.add(o),r.classList.add(c),r.textContent=n}(e,t,t.validationMessage,n,o)}(t,n,r,a),e(i,l,c)}))}))}(t,i,l,u,s,d)})),j.addEventListener("submit",(function(e){var t,n;K(g),t=w.value,n=P.value,fetch("".concat(f.baseUrl,"/cards"),{method:"POST",headers:{authorization:"8f6d1960-4165-4690-8fd7-af73d50cc61b","Content-Type":"application/json"},body:JSON.stringify({name:t,link:n})}).then((function(e){return e.ok?e.json():Promise.reject(e.status)})).then((function(e){return I.prepend(c(e.name,e.link,e.likes.length))})).catch((function(e){console.log(e)})).finally((function(){window.location.reload()})),o(S),e.target.reset()})),x.addEventListener("submit",(function(){G(!0),function(){var e=U.value,t=T.value;fetch("".concat(f.baseUrl,"/users/me"),{method:"PATCH",headers:f.headers,body:JSON.stringify({name:e,about:t})}).then((function(e){return e.ok?e.json():Promise.reject(e.status)})).catch((function(e){console.log(e)})).finally((function(){G(!1)}))}(),D.textContent=U.value,J.textContent=T.value,o(b)})),A.addEventListener("submit",(function(e){var t;K(g),t=z.value,fetch("".concat(f.baseUrl,"/users/me/avatar"),{method:"PATCH",headers:f.headers,body:JSON.stringify({avatar:t})}).then((function(e){return e.ok?e.json():Promise.reject(e.status)})).catch((function(e){console.log(e)})),N.style.backgroundImage="URL(".concat(z.value,")"),o(k),e.target.reset()})),E.forEach((function(e){e.addEventListener("click",(function(e){o(e.target.closest(".popup"))}))})),v.forEach((function(e){e.addEventListener("click",(function(e){e.target.classList.contains("popup")&&o(e.target.closest(".popup"))}))})),q.addEventListener("click",(function(){U.value=D.textContent,T.value=J.textContent,n(b)})),C.addEventListener("click",(function(){return n(k)})),B.addEventListener("mouseover",(function(){C.style.visibility="visible",C.style.opacity="1",C.style.transition="all 1s ease"})),B.addEventListener("mouseout",(function(){C.style.visibility="hidden",C.style.opacity="0",C.style.transition="all 1s ease"})),L.addEventListener("click",(function(){return n(S)}))})();