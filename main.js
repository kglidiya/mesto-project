(()=>{"use strict";var e=function(e,t,n){!function(e){return e.some((function(e){return!e.validity.valid}))}(e)?t.classList.remove(n):t.classList.add(n)};function t(e){e.classList.add("popup_opened")}function n(e){e.classList.remove("popup_opened")}function o(e,n,o){var c=O.cloneNode(!0);c.querySelector(".places__title").textContent=e,c.querySelector(".places__image").src=n;var r,a=c.querySelector(".places__image"),i=c.querySelector(".places__likes"),l=document.querySelectorAll(".places__likebtn");i.textContent=o,a.alt=e,r=l,u.then((function(e){return e.filter((function(e){return e.likes.filter((function(t){z.textContent==t.name&&r.forEach((function(n){z.textContent==t.name&&e.name==n.closest(".places__title-container").firstElementChild.textContent&&n.classList.add("places__likebtn_active")}))}))}))})).catch((function(e){console.log(e)}));var s=0;c.querySelector(".places__likebtn").addEventListener("click",(function(t){++s%2!=0?u.then((function(n){n.forEach((function(n){e===n.name&&(f(n._id,i),t.target.classList.add("places__likebtn_active"))}))})).catch((function(e){console.log(e)})):s%2==0&&u.then((function(n){n.forEach((function(n){e===n.name&&(p(n._id,i),t.target.classList.remove("places__likebtn_active"))}))})).catch((function(e){console.log(e)}))}));var _=c.querySelector(".places__deletebtn");return _.classList.add("places__deletebtn_visible"),_.addEventListener("click",(function(t){return t.target.closest(".places__container").remove(),u.then((function(t){t.forEach((function(t){e===t.name&&d(t._id)}))})).catch((function(e){console.log(e)}))})),a.addEventListener("click",(function(){t(m),D.src=this.src,D.alt=e,J.textContent=e})),c}var c,r,a,i,l,s={baseUrl:"https://nomoreparties.co/v1/plus-cohort-12",headers:{authorization:"8f6d1960-4165-4690-8fd7-af73d50cc61b","Content-Type":"application/json"}},u=fetch("".concat(s.baseUrl,"/cards"),{headers:{authorization:"8f6d1960-4165-4690-8fd7-af73d50cc61b","Content-Type":"application/json"}}).then((function(e){return e.ok?e.json():Promise.reject(e.status)})),d=function(e){return fetch("".concat(s.baseUrl,"/cards/").concat(e),{method:"DELETE",headers:s.headers}).then((function(e){return e.ok?e.json():Promise.reject(e.status)})).catch((function(e){console.log(e)}))},f=function(e,t){return fetch("".concat(s.baseUrl,"/cards/likes/").concat(e),{method:"PUT",headers:{authorization:"8f6d1960-4165-4690-8fd7-af73d50cc61b","Content-Type":"application/json"}}).then((function(e){return e.ok?e.json():Promise.reject(e.status)})).then((function(e){return t.textContent=e.likes.length})).catch((function(e){console.log(e)}))},p=function(e,t){return fetch("".concat(s.baseUrl,"/cards/likes/").concat(e),{method:"DELETE",headers:{authorization:"8f6d1960-4165-4690-8fd7-af73d50cc61b","Content-Type":"application/json"}}).then((function(e){return e.ok?e.json():Promise.reject(e.status)})).then((function(e){return t.textContent=e.likes.length})).catch((function(e){console.log(e)}))},_=document.querySelectorAll(".popup"),m=document.querySelector(".image-popup"),v=document.querySelector(".profile-popup"),h=document.querySelector(".card-popup"),y=document.querySelector(".avatar-popup"),b=document.querySelector(".profile__editbtn"),S=document.querySelectorAll(".form__savebtn"),k=document.querySelectorAll(".popup__closebtn"),q=document.querySelector(".profile__addbtn"),g=document.querySelector(".profile__avatar-editbtn"),E=(document.querySelectorAll(".places__deletebtn"),document.querySelector(".edit-profile")),L=document.querySelector(".edit-place"),C=document.querySelector(".edit-avatar"),x=document.querySelector(".form__input_link"),j=document.querySelector(".form__input_name"),A=document.querySelector(".form__input_job"),P=document.querySelector(".form__input_place"),U=document.querySelector(".form__input_avatar"),T=document.querySelector(".profile__avatar"),w=document.querySelector(".profile__avatar-overlay"),z=document.querySelector(".profile__title"),N=document.querySelector(".profile__subtitle"),B=document.querySelector(".places"),O=document.querySelector(".places-new").content,D=document.querySelector(".image-popup__photolink"),J=document.querySelector(".image-popup__caption");function H(e){e?S[0].textContent="Сохранение...":e||(S[0].textContent="Сохранить")}document.querySelector(".places__likebtn"),u.then((function(e){e.forEach((function(e){"72af520b988a7099c9eb20ae"!==e.owner._id?B.prepend(function(e,n,o){var c=O.cloneNode(!0);c.querySelector(".places__title").textContent=e,c.querySelector(".places__image").src=n;var r=c.querySelector(".places__image");r.alt=e;var a=c.querySelector(".places__likes");a.textContent=o;var i,l=document.querySelectorAll(".places__likebtn");i=l,u.then((function(e){return e.filter((function(e){return e.likes.filter((function(t){z.textContent==t.name&&i.forEach((function(t){e.name==t.closest(".places__title-container").firstElementChild.textContent&&t.classList.add("places__likebtn_active")}))}))}))})).catch((function(e){console.log(e)}));var s=0;return c.querySelector(".places__likebtn").addEventListener("click",(function(t){++s%2!=0?(console.log("like"),u.then((function(n){n.forEach((function(n){e===n.name&&(f(n._id,a),t.target.classList.add("places__likebtn_active"))}))})).catch((function(e){console.log(e)}))):s%2==0&&(console.log("dislike"),u.then((function(n){n.forEach((function(n){e===n.name&&(p(n._id,a),t.target.classList.remove("places__likebtn_active"))}))})).catch((function(e){console.log(e)})))})),r.addEventListener("click",(function(){t(m),D.src=this.src,D.alt=e,J.textContent=e})),c}(e.name,e.link,e.likes.length)):"72af520b988a7099c9eb20ae"===e.owner._id&&B.prepend(o(e.name,e.link,e.likes.length))}))})).catch((function(e){console.log(e)})),fetch("".concat(s.baseUrl,"/users/me"),{headers:s.headers}).then((function(e){return e.ok?e.json():Promise.reject(e.status)})).then((function(e){z.textContent=e.name,N.textContent=e.about,T.style.backgroundImage="URL(".concat(e.avatar,")")})).catch((function(e){console.log(e)})),q.addEventListener("click",(function(){return t(h)})),g.addEventListener("click",(function(){return t(y)})),w.addEventListener("mouseover",(function(){g.style.visibility="visible",g.style.opacity="1",g.style.transition="all 1s ease"})),w.addEventListener("mouseout",(function(){g.style.visibility="hidden",g.style.opacity="0",g.style.transition="all 1s ease"})),b.addEventListener("click",(function(){j.value=z.textContent,A.value=N.textContent,t(v)})),document.addEventListener("keydown",(function(e){"Escape"===e.key&&_.forEach((function(e){e.classList.contains("popup_opened")?n(e):e.classList.contains("popup_opened")||document.removeEventListener("keydown",n(e))}))})),k.forEach((function(e){e.addEventListener("click",(function(e){n(e.target.closest(".popup"))}))})),_.forEach((function(e){e.addEventListener("click",(function(e){e.target.classList.contains("popup")&&n(e.target.closest(".popup"))}))})),L.addEventListener("submit",(function(){var e,t;e=P.value,t=x.value,fetch("".concat(s.baseUrl,"/cards"),{method:"POST",headers:{authorization:"8f6d1960-4165-4690-8fd7-af73d50cc61b","Content-Type":"application/json"},body:JSON.stringify({name:e,link:t})}).then((function(e){return e.ok?e.json():Promise.reject(e.status)})).then((function(e){if("72af520b988a7099c9eb20ae"!==e.owner._id)return!1;B.prepend(o(e.name,e.link,e.likes.length))})).catch((function(e){console.log(e)})),n(h),P.value="",x.value=""})),E.addEventListener("submit",(function(){H(!0),function(){var e=j.value,t=A.value;fetch("".concat(s.baseUrl,"/users/me"),{method:"PATCH",headers:s.headers,body:JSON.stringify({name:e,about:t})}).then((function(e){return e.ok?e.json():Promise.reject(e.status)})).catch((function(e){console.log(e)})).finally((function(){H(!1)}))}(),z.textContent=j.value,N.textContent=A.value,n(v)})),C.addEventListener("submit",(function(){var e;e=U.value,fetch("".concat(s.baseUrl,"/users/me/avatar"),{method:"PATCH",headers:s.headers,body:JSON.stringify({avatar:e})}).then((function(e){return e.ok?e.json():Promise.reject(e.status)})).catch((function(e){console.log(e)})),T.style.backgroundImage="URL(".concat(U.value,")"),n(y),U.value=""})),r=(c={formSelector:".form",inputSelector:".form__input",submitButtonSelector:".form__savebtn",inactiveButtonClass:"form__savebtn_inactive",inputErrorClass:"form__input_type_error",errorClass:"form__input-error"}).formSelector,a=c.inputSelector,i=c.submitButtonSelector,l=c.inactiveButtonClass,Array.from(document.querySelectorAll(r)).forEach((function(t){t.addEventListener("submit",(function(e){e.preventDefault()})),function(t,n,o,c){var r=Array.from(t.querySelectorAll(n)),a=t.querySelector(o);e(r,a,c),r.forEach((function(n){n.addEventListener("input",(function(){!function(e,t){t.validity.valid?function(e,t,n,o){var c=e.querySelector(".".concat(t.id,"-error"));t.classList.remove(void 0),c.classList.remove(void 0),c.textContent=""}(e,t):function(e,t,n,o,c){var r=e.querySelector(".".concat(t.id,"-error"));t.classList.add(void 0),r.classList.add(void 0),r.textContent=n}(e,t,t.validationMessage)}(t,n),e(r,a,c)}))}))}(t,a,i,l)}))})();